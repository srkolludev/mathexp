{"version":3,"sources":["auth/local/index.js"],"names":["util","require","router","Router","post","req","res","next","authenticate","err","user","info","error","status","json","message","token","_id","role","out","name","email"],"mappings":"AAAA;;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAIC,SAAS,kBAAQC,MAAR,EAAb;;AAEAD,OAAOE,IAAP,CAAY,GAAZ,EAAiB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACxC,qBAASC,YAAT,CAAsB,OAAtB,EAA+B,UAASC,GAAT,EAAcC,IAAd,EAAoBC,IAApB,EAA0B;AACvD;AACA,QAAIC,QAAQH,OAAOE,IAAnB;AACA,QAAGC,KAAH,EAAU;AACR,aAAON,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB,CAAP;AACD;AACD,QAAG,CAACF,IAAJ,EAAU;AACR,aAAOJ,IAAIO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,yCAAV,EAArB,CAAP;AACD;;AAED,QAAIC,QAAQ,qBAAUN,KAAKO,GAAf,EAAoBP,KAAKQ,IAAzB,CAAZ;AACA,QAAIC,MAAM,EAAV;AACAA,QAAI,OAAJ,IAAeH,KAAf;AACAG,QAAI,KAAJ,IAAaT,KAAKO,GAAlB;AACAE,QAAI,MAAJ,IAAcT,KAAKU,IAAnB;AACAD,QAAI,MAAJ,IAAcT,KAAKQ,IAAnB;AACAC,QAAI,OAAJ,IAAeT,KAAKW,KAApB;AACA;AACAf,QAAIQ,IAAJ,CAASK,GAAT;AACD,GAnBD,EAmBGd,GAnBH,EAmBQC,GAnBR,EAmBaC,IAnBb;AAoBD,CArBD;;kBAuBeL,M","file":"index.js","sourcesContent":["'use strict';\n\nimport express from 'express';\nimport passport from 'passport';\nimport {signToken} from '../auth.service';\nconst util = require('util');\nvar router = express.Router();\n\nrouter.post('/', function(req, res, next) {\n  passport.authenticate('local', function(err, user, info) {\n    //console.log(util.inspect(req, {showHidden: false, depth: null}));\n    var error = err || info;\n    if(error) {\n      return res.status(401).json(error);\n    }\n    if(!user) {\n      return res.status(404).json({message: 'Something went wrong, please try again.'});\n    }\n\n    var token = signToken(user._id, user.role);\n    var out = {}\n    out[\"token\"] = token;\n    out[\"_id\"] = user._id;\n    out[\"name\"] = user.name;\n    out[\"role\"] = user.role;\n    out[\"email\"] = user.email;\n    //console.log(util.inspect(token, {showHidden: false, depth: null}));\n    res.json(out);\n  })(req, res, next);\n});\n\nexport default router;\n"]}